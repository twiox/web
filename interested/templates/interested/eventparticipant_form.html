{% extends "members/base.html" %}
{% block navbar2 %}
<div class="navbar primary_bg padding_all_small" style="margin-top:2px;">
    <a class="more_info_button float_left" style="font-size: 1.1rem;" href="{% url 'interested_index' %}#Events">
        Interessierte </a>
    <a class="float_left"> > </a>
    <a class="more_info_button float_left" style="font-size: 1.1rem;" href="{% url 'public_event' event.slug %}"> {{event.title}} </a>
    <a class="float_left"> > </a> 
    <a class="float_left strong" style="font-size: 1.1rem; color:white;"> Anmeldung </a>
</div>
{% endblock %}
{% block content %}
    <h1>Anmeldung</h1>
        <form class="padding_tb_big" id="event_form" method="POST">
            <h3> Persönliche Daten </h3>
            {% csrf_token %}
            <div class="tertiary_bg padding_all_big">
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.first_name.errors %}
                    {% for error in form.first_name.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled first_name">
                        <span class="mdc-text-field__ripple"></span>
                        <input type="text" class="mdc-text-field__input" aria-labelledby="first_name-label" name="first_name" required value=
                                {% if form.instance.first_name %} "{{form.instance.first_name}}" {% else %} "{{form.data.first_name}}" {% endif %}>
                        <span class="mdc-floating-label" id="first_name-label">Vorname</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>
                
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.last_name.errors %}
                    {% for error in form.last_name.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled last_name">
                        <span class="mdc-text-field__ripple"></span>
                        <input type="text" class="mdc-text-field__input" aria-labelledby="last_name-label" name="last_name" required value=
                                {% if form.instance.last_name %} "{{form.instance.last_name}}" {% else %} "{{form.data.last_name}}" {% endif %}>
                        <span class="mdc-floating-label" id="last_name-label">Nachname</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>
                
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.birthday.errors %}
                    {% for error in form.birthday.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled birthday">
                        <span class="mdc-text-field__ripple"></span>
                        <input type="text" class="mdc-text-field__input" aria-labelledby="birthday-label" name="birthday" required value=
                                {% if form.instance.birthday %} "{{form.instance.birthday}}" {% else %} "{{form.data.birthday}}" {% endif %}>
                        <span class="mdc-floating-label" id="birthday-label">Geburtsdatum</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>
                
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.phone.errors %}
                    {% for error in form.phone.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled phone">
                        <span class="mdc-text-field__ripple"></span>
                        <input type="text" class="mdc-text-field__input" aria-labelledby="phone-label" name="phone" required value=
                                {% if form.instance.phone %} "{{form.instance.phone}}" {% else %} "{{form.data.phone}}" {% endif %}>
                        <span class="mdc-floating-label" id="phone-label">Telefonnummer</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>
                
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.email.errors %}
                    {% for error in form.email.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled email">
                        <input type="text" class="mdc-text-field__input" aria-labelledby="email-label" name="email" required value=
                                {% if form.instance.email %} "{{form.instance.email}}" {% else %} "{{form.data.email}}" {% endif %}>
                        <span class="mdc-floating-label" id="email-label">E-Mail-Adresse</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>
                
                <div class="chair_col-5 float_left padding_rl_small">
                    {% if form.contact.errors %}
                    {% for error in form.contact.errors %}
                        <p style="color:red;">{{error}}</p>
                    {% endfor %}
                    {% endif %}
                    <label class="mdc-text-field mdc-text-field--filled contact">
                        <i class="mdc-select__dropdown-icon"></i>
                        <span class="mdc-text-field__ripple"></span>
                        <select id="select-contact" class="mdc-text-field__input" style="background-color:#333333;" name="contact" required>
                            <option value="" selected></option>
                            <option value="Telegram">Telegram</option>
                            <option value="Whatsapp">WhatsApp</option>
                            <option value="sms">SMS</option>
                        </select>
                        <span class="mdc-floating-label" id="contact-label">Kontakt während der Veranstaltung</span>
                        <span class="mdc-line-ripple"></span>
                    </label>
                </div>      
            </div>
            <br>
            {% if merch %}
                <h3>Veranstaltungs-merch</h3>
                <div class="tertiary_bg padding_all_big flex_left">
                    <div class="chair_col-5 padding_all_small flex_center">
                        <img style="max-width:60%" src="{{merch.image.url}}">
                    </div>
                    <div class="chair_col-5 padding_all_small" style="display:flex; flex-direction: column;">
                        <div class="flex_center padding_tb_small">
                            <h4>Formular</h4>
                        </div>
                        <br>
                        <div>
                        Das Bestellen von Kleidung als Erinnerung an die Veranstaltung ist <strong>freiwillig</strong>. Da wir diese nach Bedarf drucken lassen, 
                        ist ein Erwerb von Kleidung auf der Veranstaltung <strong> nicht </strong> mehr möglich. 
                        <br>
                        Bitte beachtet, dass die Kosten für die ausgewählte Kleidung auf die Kosten der Veranstaltung summiert werden.
                        <br><br>
                        Kosten: <strong>{{merch.price|floatformat:2}} €</strong>
                        </div>
                        <div class="mdc-form-field padding_rl_big">
                            <div class="mdc-checkbox">
                              <input type="checkbox" class="mdc-checkbox__native-control" id="merch_yes" name="merch_wanted">
                              <div class="mdc-checkbox__background">
                                <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                                  <path class="mdc-checkbox__checkmark-path" fill="none" stroke="white" d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
                                </svg>
                                <div class="mdc-checkbox__mixedmark"></div>
                              </div>
                            </div>
                            <label for="merch_yes" >
                                <div>{{merch.title}} dazubestellen</div>
                            </label>
                        </div>
                        <div class="padding_rl_big" id="merch_sizes" hidden>
                            {% if form.merch_size.errors %}
                            {% for error in form.merch_size.errors %}
                                <p style="color:red;">{{error}}</p>
                            {% endfor %}
                            {% endif %}
                            <label class="mdc-text-field mdc-text-field--filled merch_size">
                                <i class="mdc-select__dropdown-icon"></i>
                                <span class="mdc-text-field__ripple"></span>
                                <select id="select-merch_size" class="mdc-text-field__input" style="background-color:#333333;" name="merch_size">
                                    <option value=""></option>
                                    {% for k in sizes %}
                                        <option value={{k}}>{{k}}</option>
                                    {% endfor %}
                                </select>
                                <span class="mdc-floating-label" id="merch_size-label">Größe</span>
                                <span class="mdc-line-ripple"></span>
                            </label>
                        </div>
                        
                    </div>
                </div>
            {% endif %}
            <input id="real_costs" type="text" hidden name="costs">
            <br>
            <h3>Absenden</h3>
            <div style="clear:both;">
                <div class="flex_center tertiary_bg " style="flex-wrap:wrap;">
                    <div class=" padding_all_small"> Wenn du auf "Anmelden" drückst, bist du verbindlich für unsere Veranstaltung eingetragen. Die Kosten für
                    die Teilnahme und Zubuchungen betragen aktuell <strong id="kosten"></strong> <strong> € </strong>
                    </div>
                    <div class="chair_col-5">
                        <div class="mdc-form-field padding_all_big">
                            <div class="mdc-checkbox">
                              <input type="checkbox" class="mdc-checkbox__native-control" id="speicherung" name="confirm" required>
                              <div class="mdc-checkbox__background">
                                <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                                  <path class="mdc-checkbox__checkmark-path" fill="none" stroke="white" d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
                                </svg>
                                <div class="mdc-checkbox__mixedmark"></div>
                              </div>
                            </div>
                            
                            <label for="speicherung" >
                                <div>Ich stimme der Datenschutzerklärung und den Teilnahmebedingungen zu</div>
                            </label>
                        </div>
                    </div>
                    <div class="flex_center_vertical">
                        <div class="flex_center padding_all_big">
                            <button style="cursor:pointer;" type="submit" class="form_button" id="event_button">Anmelden</button>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function(){
                            $("#event_button").click(function(){
                                $(this).html('<i class="fas fa-spinner fa-pulse"></i>');
                                $(this).attr("disabled","")
                                setTimeout(function(){ 
                                    $("#event_button").html("Anmelden");
                                    $("#event_button").attr("disabled",false)
                                }, 3000);
                                });
                            });
                    </script>
                </div>
            </div>
        </form>
        <h3> Dokumente </h3>
        <div class="padding_all_big chair_col-5">
            <ul>
            {% if event.teilnahmebedingungen %}
            <li style="padding:5px; width:100%;"><a class="download padding_rl_big" href="{{event.teilnahmebedingungen.url}}" target="_blank"><p>Teilnahmebedingungen</p><i class="fas fa-file-download"></i></a></li>
            {% endif %}
            {% if event.datenschutz %}
            <li style="padding:5px; width:100%;"><a class="download padding_rl_big" href="{{event.datenschutz.url}}" target="_blank"><p>Datenschutzerklärung</p><i class="fas fa-file-download"></i></a></li>
            {% endif %}
            {% if event.einverstaendnis %}
            <li style="padding:5px; width:100%;"><a class="download padding_rl_big" href="{{event.einverstaendnis.url}}" target="_blank"><p>Einverständniserklärung</p><i class="fas fa-file-download"></i></a></li>
            {% endif %}
            </ul>
        </div>
    </div>
<script>
    $(document).ready(function(){
        $("#members").removeClass("here_I_am");
        $("#interested").addClass("here_I_am");
        $("#kosten").html("{{event.base_costs}}")
        $("#real_costs").attr("value", (parseFloat("{{event.base_costs}}".replace(',', '.'))).toFixed(2))
        if(document.getElementById('merch_yes').checked){
            $("#merch_sizes").attr("hidden", false)
            $("#select-merch_size").attr("required", "")
            $("#kosten").html((parseFloat("{{event.base_costs}}".replace(',', '.'))+parseFloat("{{merch.price}}".replace(',', '.'))).toFixed(2).replace(".",","))
            $("#real_costs").attr("value", (parseFloat("{{event.base_costs}}".replace(',', '.'))+parseFloat("{{merch.price}}".replace(',', '.'))).toFixed(2))
        }
        $("#merch_yes").change(function(){
            $("#merch_sizes").toggle(3);
            if(document.getElementById('merch_yes').checked){
                $("#select-merch_size").attr("required", '')
                $("#kosten").html((parseFloat("{{event.base_costs}}".replace(',', '.'))+parseFloat("{{merch.price}}".replace(',', '.'))).toFixed(2).replace(".",","))
                $("#real_costs").attr("value", (parseFloat("{{event.base_costs}}".replace(',', '.'))+parseFloat("{{merch.price}}".replace(',', '.'))).toFixed(2))
            }
            else{
                $("#select-merch_size").removeAttr("required")
                $("#kosten").html("{{event.base_costs|floatformat:2}}")
                $("#real_costs").attr("value", (parseFloat("{{event.base_costs}}".replace(',', '.'))).toFixed(2))
            }
        });
    });
</script>
<script>
    const fields = document.querySelectorAll('.mdc-text-field');
    fields.forEach(field => mdc.textField.MDCTextField.attachTo(field));
</script>
{% endblock %}